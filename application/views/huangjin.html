<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>黄金</title>
 <base href="<?php echo base_url()?>">
<link rel="stylesheet" type="text/css" href="http://layoutit.justjavac.com/css/bootstrap-combined.min.css">
<link rel="stylesheet" type="text/css" href="public/css/common.css" />

 <script src="http://libs.baidu.com/jquery/2.0.0/jquery.js"></script>
 <script type="text/javascript" src="public/js/code.js"></script>
 <script type="text/javascript" src="public/js/register.js"></script>
 
 <script type="text/javascript" src="public/layer/layer.js"></script>
 <script type="text/javascript" src="public/layer/extend/layer.ext.js"></script>
<style>
#mask{

            margin: 0 auto;

            width: 100%;

            height: 100%;

            z-index: 200;

            background-color: grey;

            position: fixed;

            left: 0;

            top: 0;

            opacity: 100;

            moz-opacity:100;

            filter:alpha(opacity=100);
			
			display:none;
			z-index:0;
}

#register{

            position:absolute;

            top:50%;

            left:50%;

            width:300px;

            height:300px;

            margin: -150px 0 0 -150px;

            vertical-align: middle;
			
			display:none;
			z-index:99;
			
}
</style>
</head>
<body>
<div class="header">
<ul>
	 <li style="color:#fff;"><span >用户</span><span><?php echo $username;?></span></li>
	 <li style="color:#fff;"><span>已获流量</span><span id="total_flow"></span></li>
 </ul>
</div>
<div class="tab_nav">
	<span class="line"></span>
	<ul>
	<li class="on"><a>黄金</a><a href="<?php echo site_url('huangjin/index')?>" id="jinyulink">[金裕]</a><a href="javascript:void(0);" id="sinalink">[新浪]</a></li>
	<li><a href="<?php echo site_url('hushen300/index')?>">沪深300</a></li>
</ul></div>
<div class="focus_data">
    <!-- 为新浪准备一个具备大小（宽高）的Dom -->
    <iframe id="dd" name="dd" src="/cygjs_fr/index.php/huangjin/huangjin_link" width="100%" height="410"></iframe>

</div>
<<<<<<< HEAD

<div class="button_ab">
	<span class="d"><a href="#">跌</a></span>
	<span class="z"><a href="#">涨</a></span>
	<dl><dt>买入价</dt><dd>1121.7</dd></dl>
=======
<div  class="row-fluid">
	<div class="user_info">
    	<ul>
    		<li class="mj"><span>买价：</span><span><em><input type="button" name="capital" id="capital" value=""/><input type="button" name="symbol" id="symbol" value="XAU" style="display:none;"/></em></span></li>
    		<li class="yl"><span>今日盈利：</span><span><em>10M&nbsp&nbsp<a href="javascript:void(0);" id="ls">成交历史</a>
    		</em></span></li>
    	</ul>
    </div>
</div>

<div class="button_ab">
	<span class="d"><a href="javascript:void(0);" id="die" class="die">跌</a></span>
	<span class="z"><a href="javascript:void(0);" id="zhang" class="zhang">涨</a></span>
>>>>>>> origin/master
</div>

<div class="user_info">
	<dl><dt><img src="http://img.hb.aicdn.com/f19f02cdd588b515902f764ebf72ff40e871a9fe29cb-B0vzSa_fw658" /></dt><dd>15818691325</dd></dl>
	<ul><li><span>可用流量</span><p><em>300</em>M</p></li></ul>
	<span class="tx"><a href="javascript:void(0);" id="qx">我要取现</a></span>
</div>

<div id="regmodal" class="modal" style="display:none;">
	<h3>请注册</h3>
	<div id="loginform">
	<ul>
		<li><label for="username">用户名:</label>
		<input type="text" name="username" id="username" class="txtfield" tabindex="1" /></li>
	
		<li><label for="password">密码:</label>
		<input type="password" name="password" id="password" class="txtfield" tabindex="2" /></li>

		<li><label for="password">确认密码:</label>
		<input type="password" name="password" id="password" class="txtfield" tabindex="3" /></li>

		<li><label for="tel">手机号:</label>
		<input type="text" name="tel" id="tel" class="txtfield" tabindex="4" /></li>

		<li><label for="code">验证码:</label>
		<input type="text" name="code" id="code" class="txtfield w2" tabindex="5" /><button>发送验证码</button></li>
	</ul>
		<div class="center"><input type="submit" name="loginbtn" id="loginbtn" class="flatbtn-red hidemodal" value="确定注册" tabindex="3"></div>
	</div>
</div>

<div id="loginmodal" class="modal" style="display:none">
	<h3>请登陆</h3>
	<ol><li class="on">用户名登陆</li><li>手机登陆</li></ol>
	<div id="loginform">
	<ul>
		<li><label for="username">用户名:</label>
		<input type="text" name="username" id="username" class="txtfield" tabindex="1" /></li>
	
		<li><label for="password">密码:</label>
		<input type="password" name="password" id="password" class="txtfield" tabindex="2" /></li>
	</ul>
		<div class="center">
		<a id="login_btn" class="flatbtn-red hidemodal">登陆</a>
		<a id="register_btn" class="flatbtn-red hidemodal">注册</a>
		</div>
	</div>
</div>

<!-- 弹出登入窗 -->
 <!--  <div class="weui_dialog_confirm"  style="display:none;">
    <div class="weui_mask"></div>
    <div class="weui_dialog">
        <img  style="margin-left:90%;"src="<?php echo base_url()?>public/img/gb.jpg" alt="关闭" />
        <div class="weui_dialog_hd"><strong class="weui_dialog_title">请登入</strong></div>
        <div calss="select" ><button style="width:50%;float:left;"class="weui_btn weui_btn_default" id="sj">手机号登入</button><button style="width:50%;"class="weui_btn weui_btn_default" id="yh">用户名登入</button></div>
        <div class="weui_dialog_bd"  id="dialog">
	           <div id="userlogin" style="margin:10px auto;"class="weui_cell_hd" >
		           <div class="weui_cell_bd weui_cell_primary" >
						<p class="weui_cell_bd" style=" padding:0 10px; ">用户名:</p>
						<div class="weui_cell_bd" >
					       <input  type="text" name="username" />
				         </div>
				    </div>
				    <div class="weui_cell_bd weui_cell_primary" >
						  <p class="weui_cell_bd" style=" padding:0 10px; " >密&nbsp&nbsp&nbsp&nbsp码:</p>
						  <div class="weui_cell_bd" >
						  <input  type="text" name="password"/></div>			 
					 </div>			 
	           </div>
			   <div id="phLogin" style="margin:10px auto; display:none;"class="weui_cell_hd" >
			      <div class="weui_cell_bd weui_cell_primary" >
					<p class="weui_cell_bd weui_cell_primary">手机号:</p>
					<div class="weui_cell_bd" style="border:1px solid #DEDEDE;line-height:2.5em;border-radius:5px;">
				       <input type="text" name="phonelg" /></div>
			       </div>
				    <div class="weui_cell_bd weui_cell_primary" >
						  <p class="weui_cell_bd weui_cell_primary" style=" padding:0 10px; " >验证码:</p>
						  <div class="weui_cell_bd" >
						  <input  type="text" name="codelg"/></div>			 
					 </div>
			 
			  </div>
        </div>
        <div class="weui_dialog_ft">
            <a href="#" class="weui_btn_dialog default" id="login_btn">登入</a>
            <a href="<?php echo site_url('huangjin/index')?>" class="weui_btn_dialog primary" id="register_btn">注册</a>
       </div>
    </div>
</div> -->

	
	
</body>
</html>
<script>

//弹出窗口

$('#qx').click(function(){
		$('#loginmodal').attr('style','display:block');
	});
//弹出 用户登入框
$('#yh').click(function(){
  if($('.dialog').html($('#userlogin').hide())){
	  $('.dialog').html($('#userlogin').show());  
  }
  if($('.dialog').html($('#phLogin').show())){
	  $('.dialog').html($('#phLogin').show())
  }
  
});
//弹出手机登入框
$('#sj').click(function(){
	if($('.dialog').html($('#userlogin').show())){
		$('.dialog').html($('#userlogin').hide());
		$('.dialog').html($('#phLogin').show());
	}else{
		$('.dialog').html($('#phLogin').show());
	}
	
	
})
	// 涨事件
$('#zhang').on('click', function(){
	/*买入价不能为空*/
	if($('#capital').val() == '') {
	layer.alert('数据加载未完成', {
    icon: 5,
    skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
	});
	return false;
	}
    $.post('/cygjs_fr/index.php/huangjin/investor_detail_add',{capital:$('#capital').val(),invest_type:1,symbol:$('#symbol').val()},function(data){
    	 // var obj = eval(data);
        // alert(data);
        var json=JSON.parse(data);
        layer.alert('看涨。买入价：'+$('#capital').val()+'。中奖请查看历史记录。', {
	    icon: 1,
	    skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
		});
        /*60秒倒计时开始*/
		var intDiff = parseInt(59); //120秒倒计时总秒数量
		function timer(intDiff) {
			window.setInterval(function() {
				var day = 0,
					hour = 0,
					minute = 0,
					second = 0; //时间默认值

				if (intDiff > -1) {
					second = Math.floor(intDiff) - (day * 24 * 60 * 60) - (hour * 60 * 60) - (minute * 60);
					if (minute <= 9) minute = '0' + minute;
					if (second <= 9) second = '0' + second;
					if (second == '00') {
						$('.zhang').html('涨');
						$('.zhang').attr('id','zhang');
					}else{
						$('.zhang').html('<s></s>' + second + ' ');
						$('.zhang').attr('id','');
					}
				}
				intDiff--;
			}, 1000);
		}
		$(function() {
			timer(intDiff);
		});
		/*60秒倒计时结束*/
    });
});
// 跌事件
$('#die').on('click', function(){
	/*买入价不能为空*/
	if($('#capital').val() == '') {
	layer.alert('数据加载未完成', {
    icon: 5,
    skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
	});
	return false;
	}
    $.post('/cygjs_fr/index.php/huangjin/investor_detail_add',{capital:$('#capital').val(),invest_type:0,symbol:$('#symbol').val()},function(data){
    	 // var obj = eval(data);
        // alert(data);
        var json=JSON.parse(data);
        layer.alert('看跌。买入价：'+$('#capital').val()+'。中奖请查看历史记录。', {
	    icon: 1,
	    skin: 'layer-ext-moon' //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
		});
        /*60秒倒计时开始*/
		var intDiff = parseInt(59); //120秒倒计时总秒数量
		function timer(intDiff) {
			window.setInterval(function() {
				var day = 0,
					hour = 0,
					minute = 0,
					second = 0; //时间默认值

				if (intDiff > -1) {
					second = Math.floor(intDiff) - (day * 24 * 60 * 60) - (hour * 60 * 60) - (minute * 60);
					if (minute <= 9) minute = '0' + minute;
					if (second <= 9) second = '0' + second;
					if (second == '00') {
						$('.die').html('跌');
						$('.die').attr('id','zhang');
					}else{
						$('.die').html('<s></s>' + second + ' ');
						$('.die').attr('id','');
					}
				}
				intDiff--;
			}, 1000);
		}
		$(function() {
			timer(intDiff);
		});
		/*60秒倒计时结束*/
    });
});
$('#ls').on('click', function(){
    // $.post('/cygjs_fr/index.php/hushen300/lishi_list',{open:123},function(data){
    //      // var obj = eval(data);
    //     // alert(data);
    //     var json=JSON.parse(data);
    //     layer.alert(json.a);
    //     // $("#lishi").html(json.a);
    // });
    layer.open({
        type: 2,
        title: '交易历史详情',
        shadeClose: true,
        shade: false,
        maxmin: true, //开启最大化最小化按钮
        area: ['893px', '600px'],
        content: '/cygjs_fr/index.php/huangjin/huangjin_html_list'
    });
});
$('#sinalink').on('click', function(){
           $("#dd").attr('src','/cygjs_fr/index.php/huangjin/huangjin_sinalink');
           $('#symbol').val('hf_GC');
});
$('#jinyulink').on('click', function(){
           $("#dd").attr('src','/cygjs_fr/index.php/huangjin/huangjin_link');
           $('#symbol').val('XAU');
});

$(function(){
	//弹出注册框的时候，同时向后台请求验证码图片
	$('#register_btn').on('click',function(){
		/*$.ajax({
			url:'<?php echo site_url("huangjin/img")?>',
			dataType:'html',
			async:false,
			success:function(data){
				$('#img_td').prepend(data);
			}
		});*/
		$('#mask').show();
		$('#register').show();	
	});
	//点击发送时发送手机验证码
	$('#btnSendCode').click(function(){
		var phone=$('#phone').val();
		//这里应该检测一下是否是电话号码，我这里省略掉
		
		$.ajax({
			url:'<?php echo site_url("huangjin/send_sms")?>',
			data:{phone:phone},
			type:'post',
			success:function(data){
				alert(data.info);
			}
		});
	});
	
	//检测用户名或者号码是否重复
	$('#username,#phone').on('blur',function(){
		var field=$(this).attr('name');//字段名称
		var value=$(this).val();//字段值
		if(!value){
			alert('不能为空！');
			return;
		};
		var post_data={};
		post_data[field]=value;
		$.ajax({
			url:'<?php echo site_url("huangjin/check")?>',
		    dataType:"json",
			type:'post',
			data:post_data,
			success:function(data){
				alert(data.info);
			}
		})
	});

	/*$('.qx').click(function(){
		//console.log(123);
	
		popCenterWindow();
		
	});*/
	//获取窗口/弹窗的高跟宽
	function init(){
		windowHeight=$(window).height();
		windowWidth=$(window).width();
		popHeight=$('#login').height();
		popWidth=$('#login').width();
	};
	//关闭窗口
	function closeWindow(){
		$('.title img').click(function(){
			$(this).parent().parent().hide('slow');
			$('#mask').hide();
			$('#login').hide();
			
		})
	};
	function popCenterWindow(){
		init();
		//计算弹出窗口的左上角Y的偏移量
		var popY=(windowHeight-popHeight)/2;
		var popX=(windowWidth-popWidth)/2;
		//设定窗口的位置
		$('#login').css('top',popY).css('left',popX).slideToggle('slow');
		closeWindow();
		
	};
	
// ajax请求注册页面
	$('#sure').click(function(){
		var code=$('#checkCode').val();
		if(code==''){
			alert('验证码不能为空');
			$("#checkCode").focus();
			return false;
		}
		var post_arr=['username','password','phone','checkCode'];
		var post_obj={};
		$.each(post_arr,function(index,item){
			post_obj[item]=$('#register').find('[name="'+item+'"]').val();
		});
		$.ajax({
			url:"<?php echo site_url('huangjin/register')?>",
			dataType:"json",
			type:"post",
			data:post_obj,
			success:function(data){
				if(data && data.success){
					alert('注册成功');
				  location.href="<?php echo site_url('huangjin/index')?>";
				}else{ 
					alert('注册失败');
				  window.history.back();
				}
			}
		})
	
	});
	//ajax请求登录页面
	$('#login_btn').click(function(){
		var post_arr=['username','password'];
		/*var username=$('.username').val();
		var password=$('.password').val();*/
		var post_obj={};
		$.each(post_arr,function(index,item){
			post_obj[item]=$('#login').find('[name="'+item+'"]').val();
		});
	   $.ajax({
		   url:"<?php echo site_url('huangjin/login_name')?>",
	       dataType:"json",
	       type:"post",
	       //data:{username:username,password:password},
		   data:post_obj,
	       success:function(data){
	    	// alert(data.info);
	    	if(data && data.success){
	    		alert(data.info);
	    		location.href="<?php echo site_url('huangjin/index')?>";
	    	}else{
	    		alert(data.info);
	    		window.history.back();
	    		
	    	}
	    	
	       }
	   })	
	});
	
	function get_current_flow(){
		$.get('<?php echo site_url('huangjin/stat_total_flow')?>',function(data){
			$('#total_flow').html(data);
		})
	}
	get_current_flow();
	
	
	
})


</script>
<!-- ECharts单文件引入 -->
<script src="http://echarts.baidu.com/dist/echarts.min.js"></script>
<script type="text/javascript">
	setInterval(function(){  
		$.ajax({
	            // url: "http://hq.sinajs.cn/?_="+new Date().getTime()+"&list=sh603518",
	            url: "http://hq.sinajs.cn/?list=hf_GC",
	            method: 'GET',
	            dataType: "script",
	            scriptCharset: "gb2312",
	            cache: true,
	            success: function(data, textStatus){
	            	var hq = hq_str_hf_GC.split(",");
	            	var title,rt_hq = '';
	            	if(Number(hq[0])>Number(7)){
	            		title = hq[3]+' +'+String(((Number(hq[3])-Number(hq[2]))*100/Number(hq[2])).toFixed(2))+'%';
	            		rt_hq = '<span style="color:Red;">'+hq[0]+'&nbsp+'+String((Number(hq[0])-Number(hq[7])).toFixed(2))+'&nbsp'+hq[1]+'%</span>';
	            	}else if(Number(hq[0])<Number(7)){
	            		title = hq[3]+' '+String(((Number(hq[3])-Number(hq[2]))*100/Number(hq[2])).toFixed(2))+'%';
	            		rt_hq = '<span style="color:Lime;">'+hq[0]+'&nbsp-'+String((Number(hq[0])-Number(hq[7])).toFixed(2))+'&nbsp'+hq[1]+'%</span>';
	            	}else{
	            		title = hq[3]+' '+String(((Number(hq[3])-Number(hq[2]))*100/Number(hq[2])).toFixed(2))+'%';
	            		rt_hq = '<span style="color:Black;">'+hq[0]+'&nbsp'+String((Number(hq[0])-Number(hq[7])).toFixed(2))+'&nbsp'+hq[1]+'%</span>';
	            	}
	            	document.title = title;
	                var html_src = '实时行情: '+rt_hq+"|最高: "+hq[3]+" | 最低: "+hq[2]+"|昨收: "+hq[7]+"| 北京时间: "+hq[6]+"";
	                var html_src_img = '<img src="http://image.sinajs.cn/newchart/v5/futures/global/min/GC.gif?'+new Date().getTime()+'">';
	                $('#capital').val(hq[3]);
	                $("#m-chart-realhq").html(html_src);
	                $("#m-chart-img").html(html_src_img);

	                $.post('/cygjs_fr/index.php/huangjin/data_add',{price:hq[3]},function(data){
	                    // alert(data);
	                });
	        	} 
	    });
	},3000);
</script>