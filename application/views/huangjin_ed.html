<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>黄金[历史]</title>
 <base href="<?php echo base_url()?>">
<link rel="stylesheet" type="text/css" href="http://layoutit.justjavac.com/css/bootstrap-combined.min.css"><!-- Bootstra框架Combined引入 -->
<link rel="stylesheet" type="text/css" href="public/css/common.css" />
<link rel="stylesheet" type="text/css" href="public/oh_static/css/oh-common.css"><!-- @author ohyeah -->
 <script src="http://libs.baidu.com/jquery/2.0.0/jquery.js"></script><!-- JQ由Baidu加速DNS提供 -->
 <script type="text/javascript" src="public/js/code.js"></script>
 <script type="text/javascript" src="public/js/register.js"></script>
 <script type="text/javascript" src="public/layer/layer.js"></script><!-- Layer弹窗组件引入 -->
 <script type="text/javascript" src="public/layer/extend/layer.ext.js"></script><!-- Layer弹窗组件引入 -->

<style>
#mask{

            margin: 0 auto;

            width: 100%;

            height: 100%;

            z-index: 200;

            background-color: grey;

            position: fixed;

            left: 0;

            top: 0;

            opacity: 100;

            moz-opacity:100;

            filter:alpha(opacity=100);
			
			display:none;
			z-index:0;
}

#register{

            position:absolute;

            top:50%;

            left:50%;

            width:300px;

            height:300px;

            margin: -150px 0 0 -150px;

            vertical-align: middle;
			
			display:none;
			z-index:99;
			
}
</style>
</head>
<body>
<div class="tab_nav">
	<span class="line"></span>
	<ul>
	<li class="on"><a href="javascript:void(0);">某天黄金趋势图</a><!-- <a href="javascript:void(0);" id="jinyulink">[金裕]</a><a href="javascript:void(0);" id="sinalink">[新浪]</a> --></li>
	<!-- <li><a href="<?php echo site_url('hushen300/index')?>">沪深300</a></li> -->
</ul></div>

<div class="focus_data">
    <!-- 为新浪准备一个具备大小（宽高）的Dom -->
    <iframe id="dd" name="dd" src="/cygjs_fr/index.php/huangjin_ed/e" width="100%" height="410"></iframe>
</div>
<div class="button_ab">
    <span class="d"><a href="javascript:void(0);" id="die" class="die">跌</a></span>
	<span class="z"><a href="javascript:void(0);" id="zhang" class="zhang">涨</a></span>
	<dl><dt>最新报价</dt><dd><input type="button" name="capital" id="capital" value=""/>
	<dt>PK</dt>
	<input type="button" name="capital1" id="capital1" value=""/>
	<input type="button" name="symbol" id="symbol" value="XAU" style="display:none;"/></dd></dl>
</div>

<div class="user_info">
	<dl><dt><img src="http://img.hb.aicdn.com/f19f02cdd588b515902f764ebf72ff40e871a9fe29cb-B0vzSa_fw658" /></dt><dd><?php echo $username;?><?php echo $uid;?></dd></dl>
	<ul><li><span>可用流量&nbsp&nbsp&nbsp&nbsp连赢x<em id='lianying'>0</em>(满3次送1M)</span><p><em>300</em>M</p></li>
	</ul>
	<span class="tx"><a href="javascript:void(0);" id="qx">我要取现</a></span>
</div>

<div id="regmodal" class="modal2" style="display:none;">
	<h3>请注册</h3>
	<div id="loginform">
	<ul>
		<li><label for="username">用户名:</label>
		<input type="text" name="username"  class="txtfield" tabindex="1" /></li>
	
		<li><label for="password">密码:</label>
		<input type="password" name="password"  class="txtfield" tabindex="2" /></li>

		<li><label for="password">确认密码:</label>
		<input type="password" name="repassword"  class="txtfield" tabindex="3" /></li>

		<li><label for="tel">手机号:</label>
		<input type="text" name="phone" id="phone1" class="txtfield" tabindex="4" /></li>

		<li><label for="code">验证码:</label>
		<input type="text" name="checkCode"  class="txtfield w2" tabindex="5" /><input id="btnSendCode1" type="button" value="发送验证码" /></li>
	</ul>
		<div class="center"><input type="submit" name="loginbtn" id="loginbtn" class="flatbtn-red hidemodal" value="确定注册" tabindex="3"></div>
	</div>
</div>

<div id="loginmodal" class="modal2" style="display:none">
	<h3>请登陆</h3>
	<ol><li class="on" id="yh">用户名登陆</li><li id="sj">手机登陆</li></ol>
	<div id="loginform">
	<div id="dialog">
	<div id="userlogin"><ul>
		<li><label for="username">用户名:</label>
		<input type="text" name="username" id="username" class="txtfield" tabindex="1" /></li>
		<li><label for="password">密码:</label>
		<input type="password" name="password"  class="txtfield" tabindex="2" /></li>
	</ul></div>
	<div id="phonelogin" style="display:none;"><ul>
		<li><label for="username">手机号:</label>
		<input type="text" name="phone" id="phone2" class="txtfield" tabindex="1" /></li>
	
		<li><label for="code">验证码:</label>
		<input type="text" name="checkCode"  class="txtfield w2" tabindex="5" /><input id="btnSendCode2" type="button" value="发送验证码" /></li>
	</ul></div></div>
	  <div class="center">
		<a id="login_btn" class="flatbtn-red hidemodal">登陆</a>
		<a id="register_btn" class="flatbtn-red hidemodal">注册</a>
		</div>
    </div>
</div>
</body>
<script type="text/javascript" src="public/js/oh-huangjin-ed.js"></script><!-- @author ohyeah -->
</html>
<script>
var InterValObj; //timer变量，控制时间  
var count = 120; //间隔函数，1秒执行  
var curCount;//当前剩余秒数  
var code = ""; //验证码  
var codeLength = 6;//验证码长度  
$('#btnSendCode1').click(function() {  
	curCount = count;  
	var phone=$("#phone1").val();//手机号码  
	if(phone != ""){  
		//产生验证码  
		for (var i = 0; i < codeLength; i++) {  
			code += parseInt(Math.random() * 9).toString();  
		}  
		//设置button效果，开始计时  
		$("#btnSendCode1").attr("disabled", "true");  
		$("#btnSendCode1").val("请在" + curCount + "秒内输入验证码");  
		InterValObj = window.setInterval(SetRemainTime, 1000); //启动计时器，1秒执行一次  
	//向后台发送处理数据  
		/*$.ajax({  
			type: "POST", //用POST方式传输  
			dataType: "text", //数据格式:JSON  
			url: 'Login.ashx', //目标地址  
			data: "phone=" + phone + "&code=" + code,  
			error: function (XMLHttpRequest, textStatus, errorThrown) { },  
			success: function (msg){ }  
		}); */ 
	}else{  
		alert("手机号码不能为空！");  
	} 
		
}) 
//timer处理函数  
function SetRemainTime() {  
	if (curCount == 0) {                  
		window.clearInterval(InterValObj);//停止计时器  
		$("#btnSendCode1").removeAttr("disabled");//启用按钮  
		$("#btnSendCode1").val("重新发送验证码");  
		code = ""; //清除验证码。如果不清除，过时间后，输入收到的验证码依然有效      
	}  
	else {  
		curCount--;  
		$("#btnSendCode1").val("请在" + curCount + "秒内输入验证码");  
	}  
}  

//弹出窗口

$('#qx').click(function(){
	//$('#loginmodal').attr('style','display:block');
	$('#loginmodal').show();
});
//弹出 用户登入框
$('#yh').click(function(){
	$('#yh').addClass('on');
	$('#sj').removeClass('on');
	$('#phonelogin').hide();
	$('#userlogin').show();
	
    
  
});
//弹出手机登入框
$('#sj').click(function(){
	$('#sj').addClass('on');
	$('#yh').removeClass('on');
	$('#userlogin').hide();
	$('#phonelogin').show();
		
})
$(function(){
	//弹出注册框的时候，同时向后台请求验证码图片
	$('#register_btn').on('click',function(){
		/*$.ajax({
			url:'<?php echo site_url("huangjin/img")?>',
			dataType:'html',
			async:false,
			success:function(data){
				$('#img_td').prepend(data);
			}
		});*/
		//$('#mask').show();
		$('#loginmodal').hide();
		$('#regmodal').show();	
	});
	//点击发送时发送手机验证码
	$('#btnSendCode1').click(function(){
		var phone=$('#phone1').val();
		//这里应该检测一下是否是电话号码，我这里省略掉
		
		
		$.ajax({
			url:'<?php echo site_url("huangjin/send_sms")?>',
			data:{phone:phone},
			type:'post',
			success:function(data){
				alert(data.info);
			}
		});
	});
	
	//检测用户名或者号码是否重复
	$('#username,#phone').on('blur',function(){
		var field=$(this).attr('name');//字段名称
		var value=$(this).val();//字段值
		if(!value){
			alert('不能为空！');
			return;
		};
		var post_data={};
		post_data[field]=value;
		$.ajax({
			url:'<?php echo site_url("huangjin/check")?>',
		    dataType:"json",
			type:'post',
			data:post_data,
			success:function(data){
				alert(data.info);
			}
		})
	});


// ajax请求注册页面
	$('#loginbtn').click(function(){
		var code=$('#checkCode').val();
		if(code==''){
			alert('验证码不能为空');
			$("#checkCode").focus();
			return false;
		}
		var post_arr=['username','password','phone','checkCode'];
		var post_obj={};
		$.each(post_arr,function(index,item){
			post_obj[item]=$('#regmodal').find('[name="'+item+'"]').val();
		});
		$.ajax({
			url:"<?php echo site_url('huangjin/register')?>",
			dataType:"json",
			type:"post",
			data:post_obj,
			success:function(data){
				if(data && data.success){
					alert('注册成功');
				  location.href="<?php echo site_url('huangjin/index')?>";
				}else{ 
					alert('注册失败');
				  window.history.back();
				}
			}
		})
	
	});
	//ajax请求登录页面
	$('#login_btn').click(function(){
		var post_arr=['username','password'];
		/*var username=$('.username').val();
		var password=$('.password').val();*/
		var post_obj={};
		$.each(post_arr,function(index,item){
			post_obj[item]=$('#login').find('[name="'+item+'"]').val();
		});
	   $.ajax({
		   url:"<?php echo site_url('huangjin/login_name')?>",
	       dataType:"json",
	       type:"post",
	       //data:{username:username,password:password},
		   data:post_obj,
	       success:function(data){
	    	// alert(data.info);
	    	if(data && data.success){
	    		alert(data.info);
	    		location.href="<?php echo site_url('huangjin/index')?>";
	    	}else{
	    		alert(data.info);
	    		window.history.back();
	    		
	    	}
	    	
	       }
	   })	
	});
	
	function get_current_flow(){
		$.get('<?php echo site_url('huangjin/stat_total_flow')?>',function(data){
			$('#total_flow').html(data);
		})
	}
	get_current_flow();
	
	
	
})
</script>
